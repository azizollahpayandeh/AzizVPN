# راهنمای اتصال ربات به پنل سنایی

## مقدمه
این راهنما نحوه اتصال ربات VPN به پنل سنایی برای ایجاد خودکار کانفیگ‌ها را توضیح می‌دهد.

## پیش‌نیازها
- پنل سنایی فعال
- توکن API پنل سنایی
- شناسه سرور در پنل سنایی

## تنظیمات محیطی

### 1. متغیرهای محیطی مورد نیاز
در فایل `.env` یا محیط سیستم، متغیرهای زیر را تنظیم کنید:

```bash
# تنظیمات پنل سنایی
SANAEL_PANEL_URL=https://your-sanael-panel.com
SANAEL_API_TOKEN=your_api_token_here
SANAEL_SERVER_ID=your_server_id_here
```

### 2. نحوه دریافت توکن API
1. وارد پنل سنایی شوید
2. به بخش API Settings بروید
3. یک توکن جدید ایجاد کنید
4. توکن را در متغیر `SANAEL_API_TOKEN` قرار دهید

### 3. نحوه دریافت شناسه سرور
1. در پنل سنایی به بخش Servers بروید
2. شناسه سرور مورد نظر را کپی کنید
3. آن را در متغیر `SANAEL_SERVER_ID` قرار دهید

## دستورات جدید ربات

### 1. تأیید سفارش و ارسال خودکار کانفیگ
```
/approve_order [user_id]
```
این دستور:
- سفارش کاربر را تأیید می‌کند
- کانفیگ را در پنل سنایی ایجاد می‌کند
- کانفیگ را به کاربر ارسال می‌کند

### 2. مشاهده سفارشات در انتظار
```
/pending_orders
```
این دستور تمام سفارشات در انتظار تأیید را نمایش می‌دهد.

### 3. تست اتصال به پنل سنایی
```
/test_sanael
```
این دستور اتصال به پنل سنایی را تست می‌کند.

## فرآیند کار

### 1. سفارش کاربر
1. کاربر از ربات خرید می‌کند
2. رسید پرداخت را ارسال می‌کند
3. سفارش در وضعیت "pending" ثبت می‌شود

### 2. تأیید ادمین
1. ادمین رسید را بررسی می‌کند
2. از دستور `/approve_order [user_id]` استفاده می‌کند
3. ربات به صورت خودکار:
   - کانفیگ را در پنل سنایی ایجاد می‌کند
   - اطلاعات کانفیگ را دریافت می‌کند
   - کانفیگ را به کاربر ارسال می‌کند

### 3. ارسال کانفیگ
کانفیگ به صورت متن VLESS ارسال می‌شود و شامل:
- آدرس سرور
- پورت
- UUID
- تنظیمات امنیت
- اطلاعات کاربر

## عیب‌یابی

### خطای "تنظیمات پنل سنایی ناقص است"
- متغیرهای محیطی را بررسی کنید
- از دستور `/test_sanael` استفاده کنید

### خطای "خطا در اتصال به پنل سنایی"
- آدرس پنل را بررسی کنید
- توکن API را بررسی کنید
- اتصال اینترنت را بررسی کنید

### خطای "خطا در ایجاد کانفیگ"
- شناسه سرور را بررسی کنید
- دسترسی‌های API را بررسی کنید
- لاگ‌های پنل سنایی را بررسی کنید

## نکات مهم

1. **امنیت**: توکن API را در جای امنی نگهداری کنید
2. **پشتیبان‌گیری**: قبل از تغییرات، از داده‌ها پشتیبان‌گیری کنید
3. **تست**: قبل از استفاده در محیط تولید، در محیط تست امتحان کنید
4. **مانیتورینگ**: لاگ‌های ربات را بررسی کنید

## پشتیبانی
در صورت بروز مشکل:
1. لاگ‌های ربات را بررسی کنید
2. از دستور `/test_sanael` استفاده کنید
3. با پشتیبانی تماس بگیرید 