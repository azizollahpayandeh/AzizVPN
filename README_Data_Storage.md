# سیستم ذخیره‌سازی داده‌ها - ربات VPN

## 📁 فایل‌های ذخیره‌سازی

ربات حالا از سیستم ذخیره‌سازی دائمی استفاده می‌کند که تمام اطلاعات در فایل‌های JSON ذخیره می‌شوند:

### فایل‌های ایجاد شده:

1. **`users_data.json`** - اطلاعات کاربران
   - نام، نام خانوادگی، یوزرنیم
   - تاریخ عضویت
   - سفارشات و کل هزینه‌ها

2. **`blocked_users.json`** - کاربران مسدود شده
   - لیست آیدی کاربران مسدود

3. **`configs_data.json`** - کانفیگ‌های آپلود شده
   - نام فایل، file_id، تاریخ آپلود

4. **`discount_data.json`** - تنظیمات تخفیف
   - درصد تخفیف فعلی

5. **`orders_data.json`** - اطلاعات سفارشات
   - جزئیات تمام سفارشات

## 🔄 سیستم ذخیره‌سازی خودکار

### Auto-Save:
- داده‌ها هر 5 دقیقه به صورت خودکار ذخیره می‌شوند
- در صورت ریستارت ربات، تمام اطلاعات حفظ می‌شوند

### ذخیره‌سازی در لحظه:
- هنگام ثبت کاربر جدید
- هنگام تغییر تخفیف
- هنگام مسدود/آزاد کردن کاربر
- هنگام آپلود/حذف کانفیگ
- هنگام ثبت سفارش جدید

## 📊 دستورات مدیریت داده‌ها

### برای ادمین:

- `/save` - ذخیره دستی تمام داده‌ها
- `/load` - بارگذاری مجدد داده‌ها از فایل‌ها
- `/stats` - نمایش آمار داده‌ها و وضعیت فایل‌ها

## 🛡️ امنیت داده‌ها

- تمام فایل‌ها با encoding UTF-8 ذخیره می‌شوند
- پشتیبان‌گیری خودکار از داده‌ها
- مدیریت خطا در ذخیره‌سازی و بارگذاری

## 📈 مزایای سیستم جدید

✅ **دائمی بودن**: داده‌ها با ریستارت ربات از بین نمی‌روند  
✅ **پشتیبان‌گیری**: امکان کپی فایل‌ها برای پشتیبان‌گیری  
✅ **مدیریت آسان**: دستورات مدیریت داده‌ها  
✅ **عملکرد بهتر**: ذخیره‌سازی بهینه و سریع  
✅ **قابلیت اطمینان**: سیستم مدیریت خطا  

## 🔧 نکات مهم

1. **پشتیبان‌گیری**: فایل‌های JSON را به طور منظم کپی کنید
2. **فضای دیسک**: فایل‌ها حجم کمی دارند اما رشد می‌کنند
3. **امنیت**: فایل‌ها حاوی اطلاعات حساس هستند، محافظت کنید
4. **دسترسی**: فقط ادمین می‌تواند داده‌ها را مدیریت کند

## 📝 مثال فایل‌ها

### users_data.json:
```json
{
  "995380371": {
    "username": "admin",
    "first_name": "Admin",
    "join_date": "2024-01-01 12:00:00",
    "orders": [],
    "total_spent": 0
  }
}
```

### discount_data.json:
```json
{
  "discount_percentage": 10
}
```

---

**توجه**: این سیستم تضمین می‌کند که تمام اطلاعات کاربران، سفارشات و تنظیمات ربات حتی پس از ریستارت حفظ شوند. 